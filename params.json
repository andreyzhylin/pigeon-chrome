{"name":"Pigeon","tagline":"","body":"# Вступление\r\n## Для чего служит pigeon?\r\nВ некоторых случаях javascript код должен правильно работать на разных веб сайтах (например расширение для браузера).\r\nВ таком случае проверка правильности часто сводится к открытию страницы, выполнению скрипта в консоли и анализу полученного результата.\r\nНо самое неприятное заключается в том, что если алгоритм слегка меняется, то необходимо выполнять все проверки заново.\r\nPigeon был создан с целью автоматизировать этот процесс.\r\n\r\n## Принцип работы\r\nPigeon реализован в виде расширения к браузеру Chrome и использует его API для запуска тестов.\r\nДля начала работы пользователю необходимо задать URL страницы на которой будут выполняться тесты и создать один или несколько тестов, которые будут на ней выполнены (_подробнее об использовании в пункте \"Пример использования\"_).\r\nПри нажатии на кнопку запуска теста, Pigeon выполнит следующие действия:\r\n1. Откроет вкладку с заданной страницей\r\n2. Дождется загрузки страницы\r\n3. Выполнит служебный код\r\n4. Выполнит код пользовательских файлов (в порядке загрузки)\r\n5. Выполнит код теста\r\n- Если в ходе выполнения возникла ошибка или пользователем вызван метод pigeon.reject, то тест пройден с ошибкой\r\n- Если все вызовы метода pigeon.expect теста получили истинное значение, то тест пройден успешно\r\n- Иначе тест провален\r\n\r\n# Установка\r\n## При помощи пакета crx\r\n1. Скачайте [последнюю версию](https://github.com/andreyzhylin/pigeon-chrome/releases/download/v1.1.6/pigeon-chrome-1.1.6.crx).\r\n2. Зайдите на страницу расширений - chrome://extensions/ (**Дополнительные инструменты > Расширения**).\r\n3. Перетащите скачанный файл на страницу.\r\n\r\n## Из исходников\r\nУстановите Node.js и затем:\r\n```\r\n$ git clone https://github.com/andreyzhylin/pigeon-chrome.git\r\n$ cd pigeon-chrome\r\n$ npm -g install grunt-cli karma bower\r\n$ npm install\r\n$ bower install\r\n$ grunt build\r\n```\r\n- Зайдите на страницу расширений - chrome://extensions/ (**Дополнительные инструменты > Расширения**).\r\n- Убедитесь, что установлен флажок \"Режим разработчика\" в правом верхнем углу.\r\n- Нажмите \"Загрузить распакованное расширение...\".\r\n- Переместитесь к папке '*/pigeon-chrome/build' и выберите её\r\n\r\n## Пример использования\r\n1. Откройте страницу \"Параметры\", вы увидите главную страницу приложения:\r\n![Главная страница приложения](https://github.com/andreyzhylin/pigeon-chrome/raw/master/common/img/sample-ru/sample-0.png) \r\n2. Переключитесь для удобства на русский язык в правом верхнем углу:\r\n![Главная страница приложения на русском](https://github.com/andreyzhylin/pigeon-chrome/raw/master/common/img/sample-ru/sample-1.png) \r\n3. Перейдите на страницу \"Настройки\" и нажмите \"Установить базовый набор\":\r\n![Главная страница приложения на русском](https://github.com/andreyzhylin/pigeon-chrome/raw/master/common/img/sample-ru/sample-2.png) \r\n4. Перейдите на страницу \"Обзор тестов\", вы увидите, что появилась таблица с базовым набором тестов:\r\n![Обзор базового набора тестов](https://github.com/andreyzhylin/pigeon-chrome/raw/master/common/img/sample-ru/sample-3.png) \r\n5. Есть 2 основных сущности, это \"страница\" и \"тест\", страницы выделены синим цветом в таблице. Нажмите на иконку редактирования напротив первой страницы:\r\n![Редактирование страницы](https://github.com/andreyzhylin/pigeon-chrome/raw/master/common/img/sample-ru/sample-4.png) \r\nОписание страницы - отображается в таблице, URL адрес - адрес на котором будут выполняться тесты, при отмеченном флажке, Pigeon будет открывать новое окно вместо новой вкладки при запуске тестов, это делает вкладку теста активной и полезно при отладке и если DOM не обновляется на неактивной вкладке.\r\n6. Вернитесь к обзору и нажмите на иконку редактирования напротив первого теста первой страницы:\r\n![Редактирование теста](https://github.com/andreyzhylin/pigeon-chrome/raw/master/common/img/sample-ru/sample-5.png) \r\nТест содержит описание, отображаемое в таблице, код, выполняемый на странице и флажок мода отладки, о котором будет речь в разделе \"Отладка тестов\". \r\n7. Перед запуском этого теста, разберем его код:\r\n```javascript\r\nvar searchInput = document.getElementsByName('q')[0];\r\n\r\npigeon.expect('Поле ввода поиска определено', typeof searchInput !== 'undefined');\r\npigeon.expect('Тег поля ввода совпадает', searchInput.tagName === 'INPUT');\r\n\r\n// Метод 'pigeon.resolve' должен вызываться, тест считается полностью выполненным\r\npigeon.resolve();\r\n```\r\nУ страницы был установлен URL - https://www.google.com/, поэтому после запуска откроется вкладка с этим адресом.\r\nПосле загрузки страницы начнет выполняться код.\r\nТест называется \"Страница загружается\", поэтому данным кодом мы:\r\n- Проверяем что строка поиска (элемент DOM с именем 'q') присутствует на странице\r\n- Строка поиска является тегом 'input'\r\n- Завершаем тест\r\n\r\nВ коде теста используются служебные методы pigeon:\r\n\r\n- pigeon.expect(message, testCase)\r\n- pigeon.resolve()\r\n\r\npigeon.expect - создает значение, которое должно быть проверено, если хотя бы один из expect методов примет значение testCase === false, то тест не будет пройдет, а в таблице будет указан message.\r\npigeon.resolve - сообщает, что тест закончил выполнение\r\n\r\nВернемся к обзору тестов и запустим данный тест:\r\n![Запуск теста](https://github.com/andreyzhylin/pigeon-chrome/raw/master/common/img/sample-ru/sample-6.png)\r\nКак мы видим тест завершился успешно, а значит все параметры переданные в pigeon.expect являются истинными значениями.\r\n8. Рассмотрим код следующего теста:\r\n```javascript\r\nlocation.href = '/#q=github';\r\n// Ждем 1 секунду, пока обрабатывается наш запрос\r\n\r\nsetTimeout(function () {\r\n  pigeon.expect('Результаты загружены', typeof ires !== 'undefined');\r\n  pigeon.expect('Адрес сайта присутствует в результатах', ires.innerText.indexOf('github.com') !== -1);\r\n\r\n  // В данном случае тест считается законченным здесь, а не в конце скрипта\r\n  pigeon.resolve();\r\n}, 1000);\r\n\r\npigeon.expect('Результаты не появляются мгновенно', typeof ires === 'undefined');\r\n// Здесь заканчивается выполнение скрипта, но тест будет выполнен\r\n// после вызова pigeon.resolve или по таймауту\r\n```\r\nВ данном случае мы меняем свойство location.href, что приводит запросу поиска, т.к. на это потребуется время, то проверку будет проводить через 1 секунду, а сразу-же проверим, что результат еще не готов.\r\n\r\nПосле этой проверки, как указано в комментарии, скрипт заканчивает работу, но т.к. метод pigeon.resolve не вызывался, тест на заканчивается.\r\n\r\nЧерез секунду вызовется функция проверки, в которой мы убедимся, что \"Google находит сайт github.com\" и вызовом метода pigeon.resolve завершим тест.\r\n\r\n9. Код третьего теста похож на код второго, но теперь мы ищем упоминания о pigeon-chrome:\r\n```javascript\r\nlocation.href = '/#q=pigeon-chrome';\r\n// Ждем 1 секунду, пока обрабатывается наш запрос\r\n\r\nsetTimeout(function () {\r\n  pigeon.expect('Результаты загружены', typeof ires !== 'undefined');\r\n  pigeon.expect('Гугл не нашел pigeon :(', ires.innerText.indexOf('pigeon-chrome') !== -1);\r\n\r\n  // В данном случае тест считается законченным здесь, а не в конце скрипта\r\n  pigeon.resolve();\r\n}, 1000);\r\n```\r\nЗапустите второй и третий тест и вы увидите, что второй завершился успешно, а третий не пройден и при клике на знак вопроса отображает message того метода pigeon.expect, который получил параметр false:\r\n![Запуск теста не пройден](https://github.com/andreyzhylin/pigeon-chrome/raw/master/common/img/sample-ru/sample-7.png)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}